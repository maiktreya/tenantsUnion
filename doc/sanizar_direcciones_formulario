<script type="text/javascript">
/**
 * Sindicato de Inquilinas - Sanitización de Direcciones en Frontend
 * Objetivo: Eliminar el 'Distrito' (ej: Centro) de la sugerencia de Google Maps.
 * Formulario ID: 5 | Campo ID: 36
 */

jQuery(document).on('gform_post_render', function(event, form_id, current_page){
    // 1. SEGURIDAD: Solo ejecutar en el formulario de afiliación (ID 5)
    if(form_id != 5) return;

    // 2. ESPERA: Damos un pequeño margen para que Google Maps cargue completamente
    setTimeout(function(){
        
        // Verificamos si el autocompletado del plugin está activo en el campo 36
        if(window.aac_input_5_36 && window.aac_input_5_36.autocomplete) {
            
            // 3. ESCUCHA: Ponemos una "oreja" digital al momento exacto en que la usuaria elige una dirección
            google.maps.event.addListener(window.aac_input_5_36.autocomplete, 'place_changed', function() {
                
                // Obtenemos los datos "crudos" de Google (sin formato de texto)
                var place = window.aac_input_5_36.autocomplete.getPlace();
                
                if (!place.address_components) return;

                var street = '';
                var number = '';

                // 4. FILTRADO: Buscamos solo la Calle (route) y el Número
                // Ignoramos deliberadamente "sublocality" o "administrative_area_level_2" (Distritos)
                for (var i = 0; i < place.address_components.length; i++) {
                    var component = place.address_components[i];
                    var addressType = component.types[0];

                    if (addressType === "route") {
                        street = component.long_name;
                    }
                    if (addressType === "street_number") {
                        number = component.long_name;
                    }
                }

                // 5. ACCIÓN: Si encontramos calle, reescribimos el campo visualmente
                if (street !== '') {
                    var cleanAddress = street;
                    if (number !== '') {
                        cleanAddress += ', ' + number;
                    }
                    
                    // Actualizamos el campo visible para la usuaria
                    jQuery('#input_5_36').val(cleanAddress);
                }
            });
        }
    }, 500); // Medio segundo de espera para asegurar carga
});
</script>
